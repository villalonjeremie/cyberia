<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Cyberia ‚Äì API Log Analyzer</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>

<header class="header">
  <h1>üõ° Cyber IA üõ°</h1>
  <p>API de collecte et d‚Äôanalyse des logs : IA & Machine Learning <br>
  Comportement anormale, DDOS, bruteforce</p>
</header>

<main class="container">
  <section class="card">
    <h2>Envoyer vos logs</h2>
    <form id="log-form">
      <input type="file" name="file" accept=".log" required>
      <button type="submit">Envoyer</button>
    </form>

    <pre id="result">En attente du fichier‚Ä¶</pre>

    <p>Collez les logs (texte format access.log)</p>

    <textarea id="logInput" placeholder='220.163.198.12 - - [26/Jan/2026:12:05:13 -0700] "POST /login HTTP/1.1" 200 3892
220.163.198.12 - - [26/Jan/2026:12:05:13 -0700] "POST /login HTTP/1.1" 200 3892
220.163.198.12 - - [26/Jan/2026:12:05:13 -0700] "POST /login HTTP/1.1" 200 3892
220.163.198.12 - - [26/Jan/2026:12:05:13 -0700] "POST /login HTTP/1.1" 200 3892
220.163.198.12 - - [26/Jan/2026:12:05:13 -0700] "POST /login HTTP/1.1" 200 3892
220.163.198.12 - - [26/Jan/2026:12:05:13 -0700] "POST /login HTTP/1.1" 200 3892
220.163.198.12 - - [26/Jan/2026:12:05:13 -0700] "POST /login HTTP/1.1" 200 3892
220.163.198.12 - - [26/Jan/2026:12:05:13 -0700] "POST /login HTTP/1.1" 200 3892
220.163.198.12 - - [26/Jan/2026:12:05:13 -0700] "POST /login HTTP/1.1" 200 3892
220.163.198.12 - - [26/Jan/2026:12:05:13 -0700] "POST /login HTTP/1.1" 200 3892'></textarea>

    <button onclick="sendLog()">Envoyer le log</button>
    <pre id="result"></pre>
  </section>

  <section class="card info">
    <h2>‚öôÔ∏è Fonctionnement</h2>
    <ul>
      <li>API Symfony (POST /api/log)</li>
      <li>Stockage PostgreSQL (jsonb)</li>
      <li>Analyse ML (Isolation Forest)</li>
      <li>D√©tection brute force & anomalies</li>
    </ul>
    <p>
    Logs entrants<br>
            ‚Üì<br>
    Pr√©diction (model_v1)<br>
            ‚Üì<br>
    Stockage logs + scores<br>
            ‚Üì<br>
    Accumulation donn√©es<br>
            ‚Üì<br>
    R√©entra√Ænement (model_v2)<br>
            ‚Üì<br>
    Validation<br>
            ‚Üì<br>
    D√©ploiement nouveau mod√®le</p>
  </section>
</main> 

<footer>
  <p>¬© 2026 ‚Äì POC s√©curit√© & IA - J.VILLALON</p>
</footer>

<script>
async function sendLog() {
  const log = document.getElementById('logInput').value;
  const result = document.getElementById('result');

  result.textContent = "‚è≥ Envoi en cours...";

  try {
    const response = await fetch('/api/log', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: log
    });

    const data = await response.json();
    result.textContent = JSON.stringify(data, null, 2);
  } catch (e) {
    result.textContent = "‚ùå Erreur API";
  }
}
</script>

<script>
document.getElementById('log-form').addEventListener('submit', async (e) => {
    e.preventDefault();

    const form = e.target;
    const result = document.getElementById('result');
    const formData = new FormData(form);

    result.textContent = '‚è≥ Envoi du fichier et analyse en cours...';

    try {
        const response = await fetch('/api/upload-log', {
          method: 'POST',
          body: formData
        });

        const data = await response.json();

        if (!response.ok) { 
            result.textContent = data.detail || '‚ùå Erreur serveur';
            return;
        }

        result.textContent =
            `üìÑ Nombre de lignes : ${data.count}\n\n` +
            data.lines.join("\n");

    } catch (error) {
        result.textContent = '‚ùå Erreur r√©seau';
        console.error(error);
    }
});
</script>



</body>
</html>
